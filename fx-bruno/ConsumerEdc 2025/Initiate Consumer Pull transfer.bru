meta {
  name: Initiate Consumer Pull transfer
  type: http
  seq: 4
}

post {
  url: {{cons-cplane-management}}/v3/transferprocesses
  body: json
  auth: inherit
}

headers {
  Content-Type: application/json
  X-Api-Key: password
}

body:json {
  {
      "@context": {
          "edc": "https://w3id.org/edc/v0.0.1/ns/"
      },
      "@type": "TransferRequestDto",
      "protocol": "dataspace-protocol-http:2025/1",
      "assetId": "{{target-asset}}",
      "contractId": "{{agreement-id}}",
      "counterPartyAddress": "http://basyx-starter-app:8090/dsp/2025/1",
      "connectorId": "provider",
      "transferType": "HttpData-PULL"
  }
}

script:post-response {
  bru.setVar("transfer-id", res.getBody()['@id']);
  
}

settings {
  encodeUrl: true
}
